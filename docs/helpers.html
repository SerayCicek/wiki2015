<!DOCTYPE html>

<html>
<head>
  <title>helpers.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>helpers.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>fs   = <span class="hljs-built_in">require</span> <span class="hljs-string">'fs'</span>
path = <span class="hljs-built_in">require</span> <span class="hljs-string">'path'</span>

hbs = <span class="hljs-keyword">new</span> Object()
templateData = <span class="hljs-keyword">new</span> Object()

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Helpers</span></span>
    <span class="hljs-attribute">constructor</span>: <span class="hljs-function"><span class="hljs-params">(handlebars, tplateData)</span> -&gt;</span>
        hbs = handlebars
        templateData = tplateData

        <span class="hljs-keyword">return</span> {
            template  : <span class="hljs-property">@template</span>
            capitals  : <span class="hljs-property">@capitals</span>
            link      : <span class="hljs-property">@link</span>
            cssInject : <span class="hljs-property">@cssInject</span>
        }

    <span class="hljs-attribute">capitals</span>: <span class="hljs-function"><span class="hljs-params">(str)</span> -&gt;</span>
        <span class="hljs-keyword">return</span> str.toUpperCase()

    <span class="hljs-attribute">cssInject</span>: <span class="hljs-function"><span class="hljs-params">(mode)</span> -&gt;</span>
        content = <span class="hljs-keyword">new</span> String()
        styles = fs.readdirSync(<span class="hljs-string">'./src/styles'</span>)
        <span class="hljs-keyword">for</span> stylesheet <span class="hljs-keyword">in</span> styles
            <span class="hljs-keyword">if</span> path.extname(stylesheet) <span class="hljs-keyword">is</span> <span class="hljs-string">'.css'</span>
                <span class="hljs-keyword">if</span> mode <span class="hljs-keyword">is</span> <span class="hljs-string">'live'</span>
                    content += <span class="hljs-string">"&lt;link rel=\"stylesheet\" href=\"http://<span class="hljs-subst">#{templateData.year}</span>.igem.org/Template:<span class="hljs-subst">#{templateData.teamName}</span>/css/<span class="hljs-subst">#{stylesheet}</span>?action=raw&amp;ctype=text/css\" type=\"text/css\" /&gt;"</span>
                <span class="hljs-keyword">else</span>
                    content += <span class="hljs-string">"&lt;link rel=\"stylesheet\" href=\"styles/<span class="hljs-subst">#{stylesheet}</span>\" type=\"text/css\" /&gt;"</span>

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> hbs.SafeString(content)

    <span class="hljs-attribute">link</span>: <span class="hljs-function"><span class="hljs-params">(linkName, mode)</span> -&gt;</span>
        <span class="hljs-keyword">if</span> linkName <span class="hljs-keyword">is</span> <span class="hljs-string">'index'</span>
            <span class="hljs-keyword">return</span> <span class="hljs-string">"index.html"</span>

        <span class="hljs-keyword">if</span> mode <span class="hljs-keyword">is</span> <span class="hljs-string">'live'</span>
            <span class="hljs-keyword">return</span> linkName</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>return “<a href="http://#{templateData.year}.igem.org/Team:#{templateData.teamName}/#{linkName}">http://#{templateData.year}.igem.org/Team:#{templateData.teamName}/#{linkName}</a>“</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span>
            <span class="hljs-keyword">return</span> <span class="hljs-string">"<span class="hljs-subst">#{linkName}</span>.html"</span>

    <span class="hljs-attribute">template</span>: <span class="hljs-function"><span class="hljs-params">(templateName, mode)</span> -&gt;</span>
        template = hbs.compile(fs.readFileSync(<span class="hljs-string">"<span class="hljs-subst">#{__dirname}</span>/src/templates/<span class="hljs-subst">#{templateName}</span>.hbs"</span>, <span class="hljs-string">'utf8'</span>))
        <span class="hljs-keyword">if</span> mode <span class="hljs-keyword">is</span> <span class="hljs-string">'live'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Don’t add preamble to live build</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> templateName <span class="hljs-keyword">is</span> <span class="hljs-string">'preamble'</span>
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> hbs.SafeString(<span class="hljs-string">''</span>)

            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> hbs.SafeString(<span class="hljs-string">"{{<span class="hljs-subst">#{templateData.teamName}</span>/<span class="hljs-subst">#{templateName}</span>}}"</span>)
        <span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Assume ‘dev’ mode if undefined
For some reason, get an extra call here with mode undefined when in dev mode</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> hbs.SafeString(template(templateData))

<span class="hljs-built_in">module</span>.exports = Helpers</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
